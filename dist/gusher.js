!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Gusher=e():t.Gusher=e()}(window,(function(){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=2)}([function(t,e,n){"use strict";var r,i="object"==typeof Reflect?Reflect:null,o=i&&"function"==typeof i.apply?i.apply:function(t,e,n){return Function.prototype.apply.call(t,e,n)};r=i&&"function"==typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)};var s=Number.isNaN||function(t){return t!=t};function u(){u.init.call(this)}t.exports=u,u.EventEmitter=u,u.prototype._events=void 0,u.prototype._eventsCount=0,u.prototype._maxListeners=void 0;var c=10;function a(t){return void 0===t._maxListeners?u.defaultMaxListeners:t._maxListeners}function f(t,e,n,r){var i,o,s,u;if("function"!=typeof n)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof n);if(void 0===(o=t._events)?(o=t._events=Object.create(null),t._eventsCount=0):(void 0!==o.newListener&&(t.emit("newListener",e,n.listener?n.listener:n),o=t._events),s=o[e]),void 0===s)s=o[e]=n,++t._eventsCount;else if("function"==typeof s?s=o[e]=r?[n,s]:[s,n]:r?s.unshift(n):s.push(n),(i=a(t))>0&&s.length>i&&!s.warned){s.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=t,c.type=e,c.count=s.length,u=c,console&&console.warn&&console.warn(u)}return t}function h(){for(var t=[],e=0;e<arguments.length;e++)t.push(arguments[e]);this.fired||(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,o(this.listener,this.target,t))}function l(t,e,n){var r={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},i=h.bind(r);return i.listener=n,r.wrapFn=i,i}function p(t,e,n){var r=t._events;if(void 0===r)return[];var i=r[e];return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?function(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}(i):y(i,i.length)}function d(t){var e=this._events;if(void 0!==e){var n=e[t];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function y(t,e){for(var n=new Array(e),r=0;r<e;++r)n[r]=t[r];return n}Object.defineProperty(u,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(t){if("number"!=typeof t||t<0||s(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");c=t}}),u.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},u.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||s(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},u.prototype.getMaxListeners=function(){return a(this)},u.prototype.emit=function(t){for(var e=[],n=1;n<arguments.length;n++)e.push(arguments[n]);var r="error"===t,i=this._events;if(void 0!==i)r=r&&void 0===i.error;else if(!r)return!1;if(r){var s;if(e.length>0&&(s=e[0]),s instanceof Error)throw s;var u=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw u.context=s,u}var c=i[t];if(void 0===c)return!1;if("function"==typeof c)o(c,this,e);else{var a=c.length,f=y(c,a);for(n=0;n<a;++n)o(f[n],this,e)}return!0},u.prototype.addListener=function(t,e){return f(this,t,e,!1)},u.prototype.on=u.prototype.addListener,u.prototype.prependListener=function(t,e){return f(this,t,e,!0)},u.prototype.once=function(t,e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e);return this.on(t,l(this,t,e)),this},u.prototype.prependOnceListener=function(t,e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e);return this.prependListener(t,l(this,t,e)),this},u.prototype.removeListener=function(t,e){var n,r,i,o,s;if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e);if(void 0===(r=this._events))return this;if(void 0===(n=r[t]))return this;if(n===e||n.listener===e)0==--this._eventsCount?this._events=Object.create(null):(delete r[t],r.removeListener&&this.emit("removeListener",t,n.listener||e));else if("function"!=typeof n){for(i=-1,o=n.length-1;o>=0;o--)if(n[o]===e||n[o].listener===e){s=n[o].listener,i=o;break}if(i<0)return this;0===i?n.shift():function(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}(n,i),1===n.length&&(r[t]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",t,s||e)}return this},u.prototype.off=u.prototype.removeListener,u.prototype.removeAllListeners=function(t){var e,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[t]),this;if(0===arguments.length){var i,o=Object.keys(n);for(r=0;r<o.length;++r)"removeListener"!==(i=o[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(e=n[t]))this.removeListener(t,e);else if(void 0!==e)for(r=e.length-1;r>=0;r--)this.removeListener(t,e[r]);return this},u.prototype.listeners=function(t){return p(this,t,!0)},u.prototype.rawListeners=function(t){return p(this,t,!1)},u.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):d.call(t,e)},u.prototype.listenerCount=d,u.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]}},function(t,e,n){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var i=r(n(9)),o=n(10);var s=function(){function t(){}return t.prototype.write=function(t,e){if("*"===localStorage.debug||"Gusher"===localStorage.debug){var n=[];n.push("%cGusher %c"+o.SEVERITY[t]+" %c"+i.default(),"color: red;","color: green;","color: #347deb;");var r=n.concat(e);console.log.apply(console.log,r)}},t.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.write(o.SEVERITY.DEFAULT,t)},t.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.write(o.SEVERITY.DEBUG,t)},t.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.write(o.SEVERITY.INFO,t)},t.prototype.notice=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.write(o.SEVERITY.NOTICE,t)},t.prototype.warning=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.write(o.SEVERITY.WARNING,t)},t.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.write(o.SEVERITY.ERROR,t)},t.prototype.crit=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.write(o.SEVERITY.CRITICAL,t)},t.prototype.alter=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.write(o.SEVERITY.ALERT,t)},t.prototype.emerg=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.write(o.SEVERITY.EMERGENCY,t)},t}();e.default=new s},function(t,e,n){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var i=r(n(3));t.exports=i.default},function(t,e,n){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var i=r(n(0)),o=r(n(4)),s=r(n(5)),u=r(n(7)),c=r(n(1)),a=function(){function t(t,e){void 0===t&&(t=""),this.key=t,this.options=e,this.emitter=new i.default,this.channels=new s.default,this.connection=this.createConnection()}return t.prototype.unsubscribe=function(t){var e=this.channels.remove(t);e&&"connected"===this.connection.state&&e.unsubscribe()},t.prototype.getAuthToken=function(){return this.options.token||""},t.prototype.setAuthToken=function(t){t&&(this.options.token=t,this.connection.unBindAll(),this.connection.disconnect(),this.connection=this.createConnection())},t.prototype.createConnection=function(){var t=this,e=new u.default(this.key,this.options);return e.bind("connected",(function(){t.subscribeAll(),t.emitter.emit("connected")})),e.bind("message",(function(e){if(e){if(e.channel){var n=t.channels.find(e.channel);n&&n.handleEvent(e.event,e.data)}e.data&&e.data.channel&&Array.isArray(e.data.channel)&&e.data.channel.forEach((function(n){var r=t.channels.find(n);r&&r.handleEvent(e.event,e.data)})),t.emitter.emit(e.event,e.data),t.emitter.emit("*",e)}})),e.bind("disconnected",(function(){t.channels.disconnect(),t.emitter.emit("disconnected")})),e.bind("retry",(function(e){t.emitter.emit("retry",e)})),e.bind("retryMax",(function(){t.emitter.emit("retryMax")})),e.bind("@closed",(function(e){t.emitter.emit("@closed",e)})),e.bind("closed",(function(e){t.emitter.emit("closed",e)})),e.bind("error",(function(e){c.default.error("Error",e),t.emitter.emit("error",e)})),e},t.prototype.channel=function(t){return this.channels.find(t)},t.prototype.allChannel=function(){return this.channels.all()},t.prototype.connect=function(){this.connection.connect()},t.prototype.disconnect=function(){this.connection.disconnect()},t.prototype.bind=function(t,e){return this.emitter.on(t,e),this},t.prototype.unbind=function(t,e){return this.emitter.removeListener(t,e),this},t.prototype.subscribe=function(t){var e=this.channels.add(t,this);return"connected"===this.connection.state&&e.subscribe(),e},t.prototype.subscribes=function(t){var e=this,n={};return Array.isArray(t)?(t.forEach((function(t){n[t]=e.channels.add(t,e)})),"connected"===this.connection.state&&this.subscribeAll(t),n):n},t.prototype.subscribeAll=function(t){var e=this,n=t||this.channels.all();o.default(n,10).forEach((function(t){e.send("gusher.multi_subscribe",{multi_channel:t})}))},t.prototype.send=function(t,e,n){this.connection.send(t,e,n)},t}();e.default=a},function(t,e){var n=1/0,r=9007199254740991,i=17976931348623157e292,o=NaN,s="[object Function]",u="[object GeneratorFunction]",c="[object Symbol]",a=/^\s+|\s+$/g,f=/^[-+]0x[0-9a-f]+$/i,h=/^0b[01]+$/i,l=/^0o[0-7]+$/i,p=/^(?:0|[1-9]\d*)$/,d=parseInt,y=Object.prototype.toString,v=Math.ceil,m=Math.max;function b(t,e,n){var r=-1,i=t.length;e<0&&(e=-e>i?0:i+e),(n=n>i?i:n)<0&&(n+=i),i=e>n?0:n-e>>>0,e>>>=0;for(var o=Array(i);++r<i;)o[r]=t[r+e];return o}function g(t,e,n){if(!_(n))return!1;var i=typeof e;return!!("number"==i?function(t){return null!=t&&function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=r}(t.length)&&!function(t){var e=_(t)?y.call(t):"";return e==s||e==u}(t)}(n)&&function(t,e){return!!(e=null==e?r:e)&&("number"==typeof t||p.test(t))&&t>-1&&t%1==0&&t<e}(e,n.length):"string"==i&&e in n)&&function(t,e){return t===e||t!=t&&e!=e}(n[e],t)}function _(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}t.exports=function(t,e,r){e=(r?g(t,e,r):void 0===e)?1:m(function(t){var e=function(t){if(!t)return 0===t?t:0;if((t=function(t){if("number"==typeof t)return t;if(function(t){return"symbol"==typeof t||function(t){return!!t&&"object"==typeof t}(t)&&y.call(t)==c}(t))return o;if(_(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=_(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(a,"");var n=h.test(t);return n||l.test(t)?d(t.slice(2),n?2:8):f.test(t)?o:+t}(t))===n||t===-n){return(t<0?-1:1)*i}return t==t?t:0}(t),r=e%1;return e==e?r?e-r:e:0}(e),0);var s=t?t.length:0;if(!s||e<1)return[];for(var u=0,p=0,E=Array(v(s/e));u<s;)E[p++]=b(t,u,u+=e);return E}},function(t,e,n){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var i=r(n(6)),o=function(){function t(){this.channels=new Map}return t.prototype.add=function(t,e){var n=this.channels.get(t);return n||(n=new i.default(t,e),this.channels.set(t,n)),n},t.prototype.all=function(){var t=[];return this.channels.forEach((function(e,n){t.push(n)})),t},t.prototype.find=function(t){return this.channels.get(t)},t.prototype.remove=function(t){var e=this.channels.get(t);return this.channels.delete(t),e},t.prototype.disconnect=function(){this.channels.forEach((function(t){return t.disconnect()}))},t}();e.default=o},function(t,e,n){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var i=r(n(0)),o=function(){function t(t,e){this.name=t,this.gusher=e,this.subscribed=!1,this.emitter=new i.default}return t.prototype.trigger=function(t,e){this.gusher.send(t,e,this.name)},t.prototype.bind=function(t,e){return this.emitter.on(t,e),this},t.prototype.unbind=function(t,e){return this.emitter.removeListener(t,e),this},t.prototype.unsubscribe=function(){this.gusher.send("gusher.unsubscribe",{channel:this.name})},t.prototype.handleEvent=function(t,e){"gusher.subscribe_succeeded"!==t&&"gusher.multi_subscribe_succeeded"!==t||(this.subscribed=!0),this.emitter.emit(t,e)},t.prototype.subscribe=function(){this.gusher.send("gusher.subscribe",{channel:this.name})},t.prototype.disconnect=function(){this.subscribed=!0},t}();e.default=o},function(t,e,n){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var i=r(n(0)),o=r(n(8)),s=r(n(1)),u=function(){function t(t,e){var n=this;this.key=t,this.options=e,this.state="initialized",this.url=e.url,this.token=e.token,this.emitter=new i.default,this.reconnection=!!e.reconnection,this.reconnectionDelay=e.reconnectionDelay?e.reconnectionDelay:3e3,this.retryMax=void 0===e.retryMax?Number.MAX_SAFE_INTEGER:e.retryMax,this.skipReconnect=!1,this.retryNum=0,this.connectionStartTimestamp=0,this.retryTimer=null,this.connection=new o.default({url:this.url,token:this.token}),this.connection.bind("open",(function(){n.connectionStartTimestamp=Date.now(),n.retryTimer&&(clearTimeout(n.retryTimer),n.retryNum=0,n.retryTimer=null),n.skipReconnect=!1,n.updateState("connected")})),this.connection.bind("message",(function(t){n.emitter.emit("message",t)})),this.connection.bind("error",(function(t){n.updateState("error",t)})),this.connection.bind("closed",(function(t){var e=Date.now()-n.connectionStartTimestamp;e>0&&0!==n.connectionStartTimestamp&&(n.emitter.emit("@closed",Object.assign({},t,{session_time:e})),s.default.debug("Session Time: "+e+" ms"),n.connectionStartTimestamp=0),n.updateState("closed",t),n.retryIn(n.reconnectionDelay)}))}return t.prototype.retryIn=function(t){var e=this;void 0===t&&(t=0),this.retryNum>=this.retryMax&&(this.disconnect(),this.emitter.emit("retryMax"),s.default.debug("Reconnect Max: ",this.retryNum)),this.reconnection&&!this.skipReconnect&&(this.retryTimer=window.setTimeout((function(){e.retryNum+=1,s.default.debug("Reconnect attempts: ",e.retryNum),e.connect(),e.emitter.emit("retry",{retry:e.retryNum})}),t))},t.prototype.bind=function(t,e){return this.emitter.on(t,e),this},t.prototype.unbind=function(t,e){return this.emitter.removeListener(t,e),this},t.prototype.unBindAll=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];t.length?this.emitter.removeAllListeners(t):this.emitter.removeAllListeners()},t.prototype.connect=function(){this.updateState("connecting"),this.connection.connect(this.token),s.default.debug("Auth",{token:this.token})},t.prototype.disconnect=function(){this.skipReconnect=!0,this.connection.close(),this.updateState("disconnected")},t.prototype.updateState=function(t,e){var n=this.state;this.state=t,n!==t&&(s.default.debug("State changed","'"+n+"' -> '"+t+"'"),this.emitter.emit("state_change",{previous:n,current:t}),this.emitter.emit(t,e))},t.prototype.send=function(t,e,n){return!!this.connection&&this.connection.send(t,e,n)},t}();e.default=u},function(t,e,n){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var i=r(n(0)),o=r(n(1)),s=function(){function t(t){this.url="",this.state="initialized",this.token="",this.url=t.url,this.token=t.token,this.state="initialized",this.emitter=new i.default}return t.prototype.bind=function(t,e){return this.emitter.on(t,e),this},t.prototype.unbind=function(t,e){return this.emitter.removeListener(t,e),this},t.prototype.connect=function(t){this.socket&&this.close();var e=this.url||"ws://127.0.0.1";t&&(e=e+"?token="+t);try{this.socket=new WebSocket(e)}catch(t){return this.onError(t),!1}return this.bindListeners(),o.default.debug("Connecting",{url:this.url,token:this.token}),this.changeState("connecting"),!0},t.prototype.close=function(){return!!this.socket&&(this.socket.close(),!0)},t.prototype.changeState=function(t,e){this.state=t,this.emitter.emit(t,e)},t.prototype.bindListeners=function(){var t=this,e=this.socket;e.onopen=function(e){t.onOpen(e)},e.onerror=function(e){t.onError(e)},e.onclose=function(e){t.onClose(e)},e.onmessage=function(e){t.onMessage(e)}},t.prototype.unbindListeners=function(){this.socket&&(this.socket.onopen=null,this.socket.onerror=null,this.socket.onclose=null,this.socket.onmessage=null)},t.prototype.onOpen=function(t){this.changeState("open"),this.socket&&(this.socket.onopen=null)},t.prototype.onError=function(t){this.emitter.emit("error",t)},t.prototype.onClose=function(t){t?this.changeState("closed",{code:t.code,reason:t.reason,wasClean:t.wasClean}):this.changeState("closed"),this.unbindListeners(),this.socket=void 0},t.prototype.onMessage=function(t){var e;try{e=JSON.parse(t.data)}catch(t){o.default.error({error:t}),e={event:"",data:""}}o.default.debug("Event recd",e),this.emitter.emit("message",e)},t.prototype.send=function(t,e,n){var r={event:t,data:e};n&&(r.channel=n),o.default.debug("Event sent",r),this.socket&&this.socket.send(JSON.stringify(r))},t}();e.default=s},function(t,e,n){"use strict";function r(t,e){var n=t.toString();return n.length>=e?n:r("0"+n,e)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){var t=new Date;return t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate()+" "+r(t.getHours(),2)+":"+r(t.getMinutes(),2)+":"+r(t.getSeconds(),2)+":"+t.getMilliseconds()}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.DEFAULT=0]="DEFAULT",t[t.DEBUG=100]="DEBUG",t[t.INFO=200]="INFO",t[t.NOTICE=300]="NOTICE",t[t.WARNING=400]="WARNING",t[t.ERROR=500]="ERROR",t[t.CRITICAL=600]="CRITICAL",t[t.ALERT=700]="ALERT",t[t.EMERGENCY=800]="EMERGENCY"}(e.SEVERITY||(e.SEVERITY={}))}])}));