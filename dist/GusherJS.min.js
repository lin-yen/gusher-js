!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Gusher=e():t.Gusher=e()}(this,function(){return function(t){function e(i){if(n[i])return n[i].exports;var o=n[i]={exports:{},id:i,loaded:!1};return t[i].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}e.__esModule=!0;var s=n(1),r=i(s),c=n(6),u=i(c),a=n(4),h=i(a),l=n(2),f=i(l),p=function(){function t(){var e=this,n=arguments.length<=0||void 0===arguments[0]?"":arguments[0],i=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];o(this,t),this.key=n,this.options=i,i.level&&f["default"].setLevel(i.level),this.emitter=new r["default"],this.channels=new h["default"],this.connection=new u["default"](this.key,this.options),this.connection.bind("connected",function(){e.subscribeAll()}),this.connection.bind("message",function(t){if(t.channel){var n=e.channel(t.channel);n&&n.handleEvent(t.event,t.data)}e.emitter.emit(t.event,t.data)}),this.connection.bind("disconnected",function(){e.channels.disconnect()}),this.connection.bind("error",function(t){f["default"].error("Error",t)})}return t.prototype.channel=function(t){return this.channels.find(t)},t.prototype.allChannel=function(){return this.channels.all()},t.prototype.connect=function(){this.connection.connect()},t.prototype.disconnect=function(){this.connection.disconnect()},t.prototype.bind=function(t,e){return this.emitter.on(t,e),this},t.prototype.unbind=function(t,e){return this.emitter.removeListener(t,e),this},t.prototype.subscribe=function(t){var e=this.channels.add(t,this);return"connected"===this.connection.state&&e.subscribe(),e},t.prototype.subscribeAll=function(){var t=this;this.channels.channels.forEach(function(e,n){t.subscribe(n)})},t.prototype.unsubscribe=function(t){var e=this.channels.remove(t);e&&"connected"===this.connection.state&&e.unsubscribe()},t.prototype.send=function(t,e,n){this.connection.send(t,e,n)},t}();e["default"]=p,t.exports=e["default"]},function(t,e){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(t){return"function"==typeof t}function o(t){return"number"==typeof t}function s(t){return"object"==typeof t&&null!==t}function r(t){return void 0===t}t.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(t){if(!o(t)||t<0||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},n.prototype.emit=function(t){var e,n,o,c,u,a;if(this._events||(this._events={}),"error"===t&&(!this._events.error||s(this._events.error)&&!this._events.error.length)){if(e=arguments[1],e instanceof Error)throw e;var h=new Error('Uncaught, unspecified "error" event. ('+e+")");throw h.context=e,h}if(n=this._events[t],r(n))return!1;if(i(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:c=Array.prototype.slice.call(arguments,1),n.apply(this,c)}else if(s(n))for(c=Array.prototype.slice.call(arguments,1),a=n.slice(),o=a.length,u=0;u<o;u++)a[u].apply(this,c);return!0},n.prototype.addListener=function(t,e){var o;if(!i(e))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,i(e.listener)?e.listener:e),this._events[t]?s(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,s(this._events[t])&&!this._events[t].warned&&(o=r(this._maxListeners)?n.defaultMaxListeners:this._maxListeners,o&&o>0&&this._events[t].length>o&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace())),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(t,e){function n(){this.removeListener(t,n),o||(o=!0,e.apply(this,arguments))}if(!i(e))throw TypeError("listener must be a function");var o=!1;return n.listener=e,this.on(t,n),this},n.prototype.removeListener=function(t,e){var n,o,r,c;if(!i(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(n=this._events[t],r=n.length,o=-1,n===e||i(n.listener)&&n.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(s(n)){for(c=r;c-- >0;)if(n[c]===e||n[c].listener&&n[c].listener===e){o=c;break}if(o<0)return this;1===n.length?(n.length=0,delete this._events[t]):n.splice(o,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},n.prototype.removeAllListeners=function(t){var e,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[t],i(n))this.removeListener(t,n);else if(n)for(;n.length;)this.removeListener(t,n[n.length-1]);return delete this._events[t],this},n.prototype.listeners=function(t){var e;return e=this._events&&this._events[t]?i(this._events[t])?[this._events[t]]:this._events[t].slice():[]},n.prototype.listenerCount=function(t){if(this._events){var e=this._events[t];if(i(e))return 1;if(e)return e.length}return 0},n.listenerCount=function(t,e){return t.listenerCount(e)}},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{"default":t}}e.__esModule=!0;var o=n(7),s=i(o);e["default"]=s["default"].getLogger("Gusher"),t.exports=e["default"]},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}e.__esModule=!0;var s=n(1),r=i(s),c=function(){function t(e,n){o(this,t),this.name=e,this.gusher=n,this.subscribed=!1,this.emitter=new r["default"]}return t.prototype.trigger=function(t,e){return this.gusher.send(t,e,this.name)},t.prototype.disconnect=function(){this.subscribed=!0},t.prototype.bind=function(t,e){return this.emitter.on(t,e),this},t.prototype.unbind=function(t,e){return this.emitter.removeListener(t,e),this},t.prototype.handleEvent=function(t,e){"subscribe_succeeded"===t&&(this.subscribed=!0),this.emitter.emit(t,e)},t.prototype.subscribe=function(){this.gusher.send("gusher.subscribe",{id:"todo",channel:this.name})},t.prototype.unsubscribe=function(){this.gusher.send("gusher.unsubscribe",{id:"todo",channel:this.name})},t}();e["default"]=c,t.exports=e["default"]},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}e.__esModule=!0;var s=n(3),r=i(s),c=function(){function t(){o(this,t),this.channels=new Map}return t.prototype.add=function(t,e){var n=this.channels.get(t);return n||(n=new r["default"](t,e),this.channels.set(t,n)),n},t.prototype.find=function(t){return this.channels.get(t)},t.prototype.remove=function(t){var e=this.channels.get(t);return this.channels["delete"](t),e},t.prototype.all=function(){for(var t=[],e=this.channels.keys(),n=Array.isArray(e),i=0,e=n?e:e[Symbol.iterator]();;){var o;if(n){if(i>=e.length)break;o=e[i++]}else{if(i=e.next(),i.done)break;o=i.value}var s=o;t.push(s)}return t},t.prototype.disconnect=function(){this.channels.forEach(function(t){return t.disconnect()})},t}();e["default"]=c,t.exports=e["default"]},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}e.__esModule=!0;var s=n(1),r=i(s),c=n(2),u=i(c),a=function(){function t(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];o(this,t),this.url=e.url||"",this.state="initialized",this.emitter=new r["default"]}return t.prototype.bind=function(t,e){return this.emitter.on(t,e),this},t.prototype.unbind=function(t,e){return this.emitter.removeListener(t,e),this},t.prototype.connect=function(){if(this.socket)return!1;try{this.socket=new WebSocket(this.url)}catch(t){return!1}return this.bindListeners(),u["default"].debug("Connecting",{url:this.url}),this.changeState("connecting"),!0},t.prototype.close=function(){return!!this.socket&&(this.socket.close(),!0)},t.prototype.changeState=function(t,e){this.state=t,this.emitter.emit(t,e)},t.prototype.bindListeners=function(){var t=this;this.socket.onopen=function(){t.onOpen()},this.socket.onerror=function(e){t.onError(e)},this.socket.onclose=function(e){t.onClose(e)},this.socket.onmessage=function(e){t.onMessage(e)}},t.prototype.unbindListeners=function(){this.socket&&(this.socket.onopen=null,this.socket.onerror=null,this.socket.onclose=null,this.socket.onmessage=null)},t.prototype.onOpen=function(){this.changeState("open"),this.socket.onopen=null},t.prototype.onError=function(t){this.emitter.emit("error",t)},t.prototype.onClose=function(t){t?this.changeState("closed",{code:t.code,reason:t.reason,wasClean:t.wasClean}):this.changeState("closed"),this.unbindListeners(),this.socket=null},t.prototype.onMessage=function(t){var e=void 0;try{e=JSON.parse(t.data)}catch(n){return u["default"].error({error:n}),void this.emitter("error",{error:n})}e&&(u["default"].debug("Event recd",e),this.emitter.emit("message",e))},t.prototype.send=function(t,e,n){var i={event:t,data:e};this.channel&&(i.channel=n),u["default"].debug("Event sent",i),this.socket.send(JSON.stringify(i))},t}();e["default"]=a,t.exports=e["default"]},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}e.__esModule=!0;var s=n(1),r=i(s),c=n(5),u=i(c),a=n(2),h=i(a),l=function(){function t(){var e=this,n=arguments.length<=0||void 0===arguments[0]?"":arguments[0],i=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];o(this,t),this.key=n,this.options=i,this.state="initialized",this.emitter=new r["default"],this.connection=new u["default"](this.options),this.connection.bind("open",function(){e.updateState("connected")}),this.connection.bind("message",function(t){e.emitter.emit("message",t)}),this.connection.bind("error",function(t){e.updateState("error",t)}),this.connection.bind("closed",function(t){e.updateState("closed",t)}),this.connect()}return t.prototype.bind=function(t,e){return this.emitter.on(t,e),this},t.prototype.unbind=function(t,e){return this.emitter.removeListener(t,e),this},t.prototype.connect=function(){this.updateState("connecting"),this.connection.connect()},t.prototype.disconnect=function(){this.connection.close(),this.updateState("disconnected")},t.prototype.updateState=function(t,e){var n=this.state;this.state=t,n!==t&&(h["default"].debug("State changed",n+" -> "+t),this.emitter.emit("state_change",{previous:n,current:t}),this.emitter.emit(t,e))},t.prototype.send=function(t,e,n){return!!this.connection&&this.connection.send(t,e,n)},t}();e["default"]=l,t.exports=e["default"]},function(t,e,n){!function(e,n){t.exports=n()}(this,function(){return function(t){function e(i){if(n[i])return n[i].exports;var o=n[i]={exports:{},id:i,loaded:!1};return t[i].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}e.__esModule=!0;var s=n(1),r=i(s),c=function(){function t(){o(this,t)}return t.prototype.getLogger=function(t){var e=new r["default"](t);return e},t}();e["default"]=new c,t.exports=e["default"]},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t){return"string"==typeof t}function o(t,e){var n=""+t;return n.length>=e?n:o("0"+n,e)}function s(){var t=new Date;return t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate()+" "+o(t.getHours(),2)+":"+o(t.getMinutes(),2)+":"+o(t.getSeconds(),2)+":"+t.getMilliseconds()}e.__esModule=!0;var r=e.LEVEL_MAP={DEBUG:1,INFO:2,WARN:3,ERROR:4,FATAL:5},c=e.LEVEL_KEY={1:"DEBUG",2:"INFO",3:"WARN",4:"ERROR",5:"FATAL"},u=function(){function t(){var e=arguments.length<=0||void 0===arguments[0]?"LOG":arguments[0],i=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];n(this,t),this.name=e,this.level=r[i.level]||r.INFO}return t.prototype.setLevel=function(t){r[t]&&(this.level=r[t])},t.prototype.debug=function(t){if(i(t)){for(var e=arguments.length,n=Array(e>1?e-1:0),o=1;o<e;o++)n[o-1]=arguments[o];this.write(r.DEBUG,t,n)}},t.prototype.info=function(t){if(i(t)){for(var e=arguments.length,n=Array(e>1?e-1:0),o=1;o<e;o++)n[o-1]=arguments[o];this.write(r.INFO,t,n)}},t.prototype.warn=function(t){if(i(t)){for(var e=arguments.length,n=Array(e>1?e-1:0),o=1;o<e;o++)n[o-1]=arguments[o];this.write(r.WARN,t,n)}},t.prototype.error=function(t){if(i(t)){for(var e=arguments.length,n=Array(e>1?e-1:0),o=1;o<e;o++)n[o-1]=arguments[o];this.write(r.ERROR,t,n)}},t.prototype.fatal=function(t){if(i(t)){for(var e=arguments.length,n=Array(e>1?e-1:0),o=1;o<e;o++)n[o-1]=arguments[o];this.write(r.FATAL,t,n)}},t.prototype.write=function(t,e,n){if(t>=this.level&&i(e)){var o=console[c[t].toLowerCase()]?console[c[t].toLowerCase()]:console.log;o.apply(void 0,["["+s()+"] ["+c[t]+"] "+this.name+" - "+e].concat(n))}},t}();e["default"]=u}])})}])});